<!DOCTYPE html>
<html>

<!-- head section -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Dances with Factors (Tutorial)</title>
  <meta name="description" content="Interactive Project Link">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400" />
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Architects+Daughter">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/blog/tutorials/2015/02/22/dances-with-factors-tutorial">
</head>


<body>
<!-- navbar section -->
<nav role="navigation" class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><i class="fa fa-rocket"></i> Datanaut</a>
    </div>
    <!-- navbar left -->
    <div id="navbarCollapse" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/about"><i class="fa fa-user"></i> about</a></li>
        <li><a href="/blog/"><i class="fa fa-pencil-square-o"></i> blog</a></li>
        <li><a href="/projects/"><i class="fa fa-code"></i> projects</a></li>
        <li><a href="/resume/"><i class="fa fa-file-text-o"></i> resume</a></li>
      </ul>
      <!-- navbar right -->
      <ul class="nav navbar-nav navbar-right">
        <ul class="nav navbar-nav">
        </ul>
      </ul>
    </div>
  </div>
</nav>


<div class="wrapper">
  <!-- header -->
<header class="post-detail">
  <h1>
    <a href="/blog/"><i class="fa fa-pencil-square-o"></i></a>
    Dances with Factors (Tutorial)
  </h1>
  <p>
    Feb 22, 2015
    <a href="/blog/tutorials">in tutorials</a>
  </p>

  <!-- tags -->
  <p class="text-small">
    
    
    <a href="/blog/tags/#D3.js">#D3.js</a> &#149;
    
    <a href="/blog/tags/#primes">#primes</a> &#149;
    
    <a href="/blog/tags/#math">#math</a> &#149;
    
    
  </p>

  <img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-180.png" />
  
</header>


<!-- article -->
<article>
  <h2 id="interactive-project-link"><a href="http://chrisrzhou.datanaut.io/projects/d3-dances-with-factors/">Interactive Project Link</a></h2>

<hr>

<h2 id="contents">Contents</h2>

<ul>
<li>  <a href="#overview">Overview</a></li>
<li>  <a href="#math">Math</a>

<ul>
<li><a href="#prime-factorization">Prime factorization</a></li>
<li><a href="#adjustments">Adjustments</a></li>
</ul></li>
<li>  <a href="#d3">D3</a>

<ul>
<li><a href="#generating-points">Generating points</a></li>
<li><a href="#visualization-components">Visualization components</a></li>
<li><a href="#updates-and-transitions">Updates and transitions</a></li>
</ul></li>
<li>  <a href="#adding-user-interactions">Adding User Interactions</a>

<ul>
<li><a href="#stop">Stop</a></li>
<li><a href="#forward">Forward</a></li>
<li><a href="#backward">Backward</a></li>
<li><a href="#search">Search</a></li>
</ul></li>
<li>  <a href="#samples">Samples</a></li>
<li>  <a href="#resources">Resources</a></li>
</ul>

<hr>

<h2 id="overview">Overview</h2>

<p>Dances with Factors is inspired by the creation of <a href="http://www.datapointed.net/visualizations/math/factorization/animated-diagrams/">Stephen Von Worley</a>, which in turn is based on the original idea by
<a href="http://mathlesstraveled.com/2012/10/05/factorization-diagrams/">Brent Yorgey</a>.</p>

<p>This visualization helps us track the prime factorization of a number. We can easily identify primes when we arrive at a
simple circle (i.e. a prime cannot be composed of smaller divisors). We can also identify common patterns of smaller prime
divisors e.g. <code>2</code>, <code>3</code>, <code>5</code>.</p>

<p>This tutorial will explain how we can organize the project workflow into very simple and intuitive parts. A 
pseudocode workflow is presented:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// generate prime factorization of n e.g. 180 = [2, 2, 3, 3, 5]</span>
<span class="nx">factors</span> <span class="o">=</span> <span class="nx">primeFactors</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>

<span class="c1">// generate an array of point objects from factors eg. points = [point_1, point_2, ... point_n]</span>
<span class="nx">points</span> <span class="o">=</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span>

<span class="c1">// initialize vis object and build update function that contains D3 code to draw and update vis using the points data</span>
<span class="nx">init</span><span class="p">()</span>
<span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">setInterval</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="nx">speed</span><span class="p">)</span>

<span class="c1">// pseudocode for update</span>
<span class="kd">function</span> <span class="nx">update</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">number</span> <span class="o">++</span><span class="p">;</span>  <span class="c1">// update number</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">factors</span> <span class="o">=</span> <span class="nx">primeFactors</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="p">);</span>  <span class="c1">// update factors</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">points</span> <span class="o">=</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">factors</span><span class="p">);</span>  <span class="c1">// update factors</span>

  <span class="c1">// D3 code to draw points and update transitions</span>
  <span class="p">...</span>

<span class="p">}</span>
</code></pre></div>
<p>You can download the files used in this guide in the <a href="https://gist.github.com/chrisrzhou/3fec15b05684fa0cf42e">Github source code</a>.</p>

<p><sub>(<a href="#contents">back to contents</a>)</sub></p>

<hr>

<h2 id="math">Math</h2>

<blockquote>
<p>The fundamental theorem of arithmetic states that every integer greater than 1 is either prime itself or a product of
  prime numbers.</p>
</blockquote>

<p>The fundamental theorem of arithemetic is the basis for this visualization.  Given a number <code>n</code>, we are guaranteed an array
of prime factors <code>[p1, p2, p3, ... pn]</code>, which we use as a foundation for iteratively drawing subgroups of points in the
visualization.</p>

<h3 id="prime-factorization">Prime factorization</h3>

<p>Bulk of the prime factorization code was derived from a previous Python script that I worked on to solve mathematical
problems on <a href="http://nbviewer.ipython.org/github/chrisrzhou/nbEuler/blob/master/notebooks/notebook_003.ipynb">Project Euler</a>.  Porting the implementation to Javascript is fairly easy, and we will build two functions
<code>primeFactors</code> and <code>getFactor</code> to generate all prime factors of an integer <code>n</code> in ascending order.</p>

<p>Here is the code for <code>primeFactors</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Return array of prime factors (in ascending order) of n.
 * 
 * We will represent even powers of 2 as 4, for ease of plotting
 * 
 * Examples:
 *    primeFactors(1) = []
 *    primeFactors(10) = [2, 5]
 *    primeFactors(5) = [5]
 */</span>
<span class="kd">function</span> <span class="nx">primeFactors</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">throw</span> <span class="s2">"Argument error"</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">n</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">factor</span> <span class="o">=</span> <span class="nx">getFactor</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span> <span class="c1">// call getFactor function</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">factor</span><span class="p">);</span>
    <span class="nx">n</span> <span class="o">/=</span> <span class="nx">factor</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>  We start with a number <code>n</code> and assert that it is greater than <code>1</code>.</li>
<li>  Beginning with <code>n</code>, we will obtain the <strong>smallest</strong> prime factor of <code>n</code> with the helper function <code>getFactor</code> and assign
it to <code>factor</code>.</li>
<li>  Divide and update <code>n</code> by <code>factor</code> while collecting the factors in the array <code>result</code>.</li>
<li>  Iteratively repeat the process until we arrive on the termination condition i.e. <code>n = 1</code>.</li>
<li><p>An example is provided below:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// example primeFactors(120) = [2, 2, 2, 3, 5]</span>
<span class="nx">primeFactors</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">2</span><span class="p">,</span>  <span class="c1">// getFactor(120) = 2, n updates to 60</span>
    <span class="mi">2</span><span class="p">,</span>  <span class="c1">// getFactor(60) = 2, n updates to 30</span>
    <span class="mi">2</span><span class="p">,</span>  <span class="c1">// getFactor(30) = 2, n updates to 15</span>
    <span class="mi">3</span><span class="p">,</span>  <span class="c1">// getFactor(15) = 3, n updates to 5</span>
    <span class="mi">5</span><span class="p">,</span>  <span class="c1">// getFactor(5) = 5, n updates to 1</span>
<span class="p">]</span>
</code></pre></div></li>
</ul>

<p>The implementation for the helper function <code>getFactor</code> is provided below:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/** 
 * Return smallest prime factor of n.
 */</span>
<span class="kd">function</span> <span class="nx">getFactor</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">throw</span> <span class="s2">"Argument error"</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">(</span><span class="nx">n</span><span class="p">));</span> <span class="nx">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">%</span> <span class="nx">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">n</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>We start with a number <code>n</code> and return <code>2</code> if <code>n</code> is even (since <code>2</code> is the smallest factor that divides an even number).</li>
<li>If <code>n</code> is odd, we iteratively check to see if it is divisible by <code>i</code> where <code>i</code> is incremented by <code>2</code>.</li>
</ul>

<h3 id="adjustments">Adjustments</h3>

<p>We now have the math code that generates an array of prime factors for any integer <code>n</code>.  However, we need to make a small
output adjustment to the <code>factors</code> array to simplify subsequent D3 visualizations.</p>

<p>In particular, we wish to visualize groups of <code>2</code> and <code>4</code> differently.  Take a look at the desired outputs of <code>8</code> and <code>16</code>
shown below and notice how they are grouped differently.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-8.png" alt="image-8"> <img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-16.png" alt="image-16"></p>

<blockquote>
<p>We want to group points together in a square (<code>4</code>) rather than sets of pairs (<code>2</code>) whenever possible.</p>
</blockquote>

<p>We can accomplish this grouping easily by &quot;cheating&quot; and assume that <code>4</code> is a unique &quot;prime&quot; which cannot be broken down
into simpler representation of smaller primes.</p>

<p>Mathematically we know that this is not true, but this small change allows for a much simpler D3 visualization
implementation since we can ignore special plotting cases for <code>2</code> and <code>4</code>, and rely entirely on the geometry of angles to
layout the points.</p>

<p>The code adjustment is as simple as adding a conditional<code>return</code> statement in <code>getFactor</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//function getFactor(n) {</span>
<span class="c1">//  if (n &lt; 2) throw "Argument error";</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
<span class="c1">//  if (n % 2 == 0) return 2;</span>
<span class="c1">//  for (var i = 3; i &lt;= Math.floor(Math.sqrt(n)); i += 2) {</span>
<span class="c1">//    if (n % i == 0) return i;</span>
<span class="c1">//  }</span>
<span class="c1">//  return n;</span>
<span class="c1">//}</span>
</code></pre></div>
<p>This prioritizes returning a factor of <code>4</code> whenever possible and returning <code>2</code> only when necessary.  As a result, the
outputs of <code>primeFactors</code> is now different.  For the same example above:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// previously primeFactors(120) = [2, 2, 2, 3, 5]</span>
<span class="nx">primeFactors</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>  <span class="c1">// returning 4 first</span>
</code></pre></div>
<p>Lastly, let&#39;s write a function that helps print out a string representation of our prime <code>factors</code> array.  We will print
<code>&quot;prime&quot;</code> when our <code>factors</code> array has only one element, and iteratively print out a concatenated string of factors
otherwise.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Print string representation of array of prime factors
 * Examples
 *    printFactors([4, 3, 5]) = "2 × 2 × 3 × 5"
 *    printFactors([3, 5]) = "3 × 5"
 *    printFactors([7]) = "prime"
 */</span>
 <span class="kd">function</span> <span class="nx">printFactors</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">string</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">factors</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">string</span> <span class="o">=</span> <span class="nx">factors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">?</span> <span class="s2">"2 × 2"</span> <span class="p">:</span> <span class="s2">"prime"</span><span class="p">;</span>
     <span class="k">return</span> <span class="nx">string</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="nx">factors</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">factor</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">stringFactor</span> <span class="o">=</span> <span class="nx">factor</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">?</span> <span class="s2">"2 × 2"</span> <span class="p">:</span> <span class="nx">factor</span><span class="p">;</span>
     <span class="nx">string</span> <span class="o">+=</span> <span class="nx">stringFactor</span> <span class="o">+</span> <span class="s2">" × "</span><span class="p">;</span>
   <span class="p">});</span>
   <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>  <span class="c1">// remove last two characters</span>
 <span class="p">}</span>
</code></pre></div>
<blockquote>
<p>If you have strong opinions to not alter the mathematical sanctity of prime factorization and prefer to delegate logic
  to their responsible areas, I&#39;m definitely with you on that.  But this is one simple tweak that would make our life a
  lot easier with D3 plotting, as we will now discuss in the next section.</p>
</blockquote>

<p><sub>(<a href="#contents">back to contents</a>)</sub></p>

<hr>

<h2 id="d3">D3</h2>

<blockquote>
<p>Please refer to the <a href="https://gist.githubusercontent.com/chrisrzhou/3fec15b05684fa0cf42e/raw/c57df3d28276ae2affa786a408fd042ce51e14b3/draw.js">draw.js</a> file for function referenced throughout this section.</p>
</blockquote>

<p>Jason Davies has implemented a <a href="http://www.jasondavies.com/factorisation-diagrams/">recursive solution in D3</a> for this problem, which recursively calls the D3
draw function on subplots to rescale, transform and translate SVGs to achieve the desired visualization.  His implementation
is elegant and simple to understand, but has a slight drawback on restrictive animation of individual points and
transitions.</p>

<p>I wanted to mimic the effect created by <a href="http://www.datapointed.net/visualizations/math/factorization/animated-diagrams/">Stephen Von Worley</a>, which means that I have to generate all the data and its
attributes to allow D3 to work its transition magic on new and old data states.</p>

<p>The ultimate challenge with this approach is to implement a way to describe the geometry, position, size, and angles of all
the points from an array of prime factors.</p>

<h3 id="generating-points">Generating points</h3>

<blockquote>
<p>In this section, we will assume complete implementation of D3 visualization components (described in the next section) in
  order to provide a basis to focus the discussion solely on pseudocode and design of the function <code>generatePoints</code>. 
  <code>generatePoints</code> in turn guarantees a dataset of <code>point</code> objects that D3 can rely on for visualization.</p>
</blockquote>

<p>The first thing before we start is to ask what does D3 fundamentally require to do its job?</p>

<p>I&#39;m picturing the following D3 pseudocode for drawing a point:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">point</span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"svg:circle"</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">r</span><span class="p">;</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span> <span class="p">})</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span> <span class="p">})</span>
</code></pre></div>
<p>Careful mental construction informs us that simply having knowledge on a point&#39;s radius and Cartesian coordinates (<code>r</code>, <code>x</code>,
<code>y</code>) would be sufficient conditions to handling the visualization.</p>

<p>Given these minimal sufficient parameters, let us first build a helper function to create a <code>point</code> object that we will be
reusing throughout this section.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// helper function to create a point</span>
<span class="kd">function</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">r</span><span class="p">:</span> <span class="nx">r</span><span class="p">,</span>
    <span class="na">x</span><span class="p">:</span> <span class="nx">x</span><span class="p">,</span>
    <span class="na">y</span><span class="p">:</span> <span class="nx">y</span><span class="p">,</span>
  <span class="p">};</span>
  <span class="k">return</span> <span class="nx">point</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>We will use the number <code>180 = [4, 3, 3, 5]</code> as a sample number in this section to help us organize our implementation for
<code>generatePoints</code>.</p>

<blockquote>
<p>Recall that we are treating <code>2 × 2</code> as <code>4</code> for purposes of visualization.</p>
</blockquote>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-180.png" alt="image-180"></p>

<p>We see that <code>180</code> is constructed in rings of <code>5 -&gt; 3 -&gt; 3 -&gt; 4</code> (counting from outer rings to inner rings), which is exactly
the reverse order of the <code>factors</code> array (<code>[4, 3, 3, 5]</code>) that we generated with <code>primeFactors</code>.</p>

<p>This suggests that we can utilize a loop going through elements in the array in reverse order to iteratively generate
points.  We would terminate the loop when we exhaust all factors in the array.</p>

<p>A starting template for <code>generatePoints</code> could look like this:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Generate and distribute points
 */</span>
<span class="kd">function</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// initialize variables</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">point</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">factors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="c1">// build points from outwards</span>
    <span class="c1">// code to update x, y, r and create points</span>
  <span class="p">}</span> 
  <span class="k">return</span> <span class="nx">points</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>With this template in place, we can try to express the other variables <code>x</code>, <code>y</code>, <code>r</code> in terms of <code>n</code> (i.e. <code>x</code>, <code>y</code>, <code>r</code>,
are functions of <code>n</code>).</p>

<p>We first notice that the <code>r</code> should be divided by some factor of <code>n</code> to allow us to fit <code>n</code> points within a unit area. 
Let&#39;s assume for simplicity that <code>r</code> as a function of <code>n</code> can be written as:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">r</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">n</span>
</code></pre></div>
<p>Next, we observe that <code>n</code> represents the number of vertices of a subgroup, which will allow us to evenly generate angles <code>a</code>
to radially distribute the points.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span>  <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span>
<span class="p">}</span>
</code></pre></div>
<p>From basic trigonometry, we know that <code>x</code> and <code>y</code> can be calculated as a function of the angle <code>a</code>:</p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-trig.gif" alt="image-trig"></p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
<span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</code></pre></div>
<p>We now have a complete set of generated values <code>x</code>, <code>y</code>, and <code>r</code> that satisfies our minimum requirements for plotting
points.  We can now create a <code>point</code> object using our helper function <code>createPoint(r, x, y)</code>.</p>

<p>To recap, <code>generatePoints</code> now looks something along the lines of:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// initialize variables</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">point</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">factors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="c1">// build points from outwards</span>
    <span class="nx">r</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">n</span> <span class="c1">// scale r smaller by n each loop iteration</span>
    <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// loop through each vertex</span>
      <span class="nx">a</span>  <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span>  <span class="c1">// calculate the angle of the point</span>
      <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>  <span class="c1">// update x</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>  <span class="c1">// update y</span>
      <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>  <span class="c1">// create point object</span>
      <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>  <span class="c1">// add to points</span>
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="k">return</span> <span class="nx">points</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>If we try to plot these generated points with D3, we notice something terribly wrong:</p>

<blockquote>
<p>We are only generating a total of <code>4 + 3 + 3 + 5 = 15</code> points when we need to generate <code>180 = 4 * 3 * 3 * 5</code> points.</p>
</blockquote>

<p>We need to somehow build points from the outer set of points and for each of those points, multiply out the inner points
recursively.</p>

<p>We can achieve this through the use of a temporary variable <code>parentPoints</code>, which holds a list of all current points in the
loop that provide a reference to build out more points for each of the parent points.  Our general while loop needs to
account if we are on the outer loop or within the recursive inner loop, and this can be implemented by providing a check on
<code>points.length == 0</code>.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">parentPoints</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">point</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">factors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="nx">r</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">n</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// account for first set of points</span>
      <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span>  <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
        <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  <span class="c1">// if we enter the inner loop, we need to create points based on parent points</span>
      <span class="nx">parentPoints</span> <span class="o">=</span> <span class="nx">points</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span> <span class="c1">// create shallow copy of points</span>
      <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// reset points array;</span>
      <span class="nx">parentPoints</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">parentPoint</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// build new points using parentPoints as a template</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">da</span><span class="p">;</span>
          <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
          <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
          <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
          <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="k">return</span> <span class="nx">points</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>When we check <code>points.length</code> in the JavaScript console, we see that the dimension of the array now matches up correctly to
the number, but a quick look at the visualization shows that the dimensions are all wrong!  Here&#39;s what it would look like
for <code>180</code> based on our current implementation of <code>generatePoints</code>.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-180-wrong.png" alt="image-180-wrong"></p>

<p>A number of things are clearly wrong at this point.  We notice that the points are all stacked on each other when they
should be fanning out from their parent points.  The radius scaling is also not correct.</p>

<p>The immediate fix we should make lies in the generation of child points from parent points.  We notice that the general
trigonometry formulas don&#39;t quite work:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
<span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
</code></pre></div>
<p>The new child points need to be drawn with the parent point&#39;s location as a frame of reference.  Luckily, we have access to
this from the <code>parentPoint</code> object that we created.  A simple change here will be to specify the <code>parentPoint</code> location as
the frame of reference:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">parentPoints</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">parentPoint</span><span class="p">)</span> <span class="p">{</span>
   <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">da</span><span class="p">;</span>
     <span class="nx">x</span> <span class="o">=</span> <span class="nx">parentPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span><span class="p">;</span>  <span class="c1">// refer to x position of parentPoint;</span>
     <span class="nx">y</span> <span class="o">=</span> <span class="nx">parentPoint</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span><span class="p">;</span>  <span class="c1">// refer to y position of parentPoint;</span>
     <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
     <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
   <span class="p">});</span>
 <span class="p">})</span>
</code></pre></div>
<p>If you are still paying attention, you noticed that we have introduced a variable <code>d</code>, which represents the depth factor
that we need to scale as we enter each recursive loop.  This scale factor should depend on <code>n</code> since every time we arrive at
a nested set of <code>n</code> vertices, we should scale all our dimensions down by a factor of <code>n</code>.  We will introduce <code>d</code> at the very
start of our <code>while</code> loop.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">parentPoints</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">point</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// initiate d</span>
  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// initiate n</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">factors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">d</span> <span class="o">*=</span> <span class="nx">n</span>  <span class="c1">// scale d by n</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
    <span class="nx">r</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">n</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">...</span>

        <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>  
      <span class="nx">parentPoints</span> <span class="o">=</span> <span class="nx">points</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
      <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">parentPoints</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">parentPoint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">da</span><span class="p">;</span>
          <span class="nx">x</span> <span class="o">=</span> <span class="nx">parentPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span><span class="p">;</span>  <span class="c1">// d applied on child point</span>
          <span class="nx">y</span> <span class="o">=</span> <span class="nx">parentPoint</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span><span class="p">;</span>
          <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
          <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span> 
  <span class="k">return</span> <span class="nx">points</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Now testing our visualization in D3 yields something that looks much more decent:</p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-180-wrong2.png" alt="image-180-wrong2"></p>

<p>We notice that there are slight issues with the orientation/rotation or our current visualization.  We will leave this for
the user to confirm that a simple introduction of an offset variable <code>da</code> (which is also a function of <code>n</code>) can help fix
this problem.  In general, the offset should be set as:</p>

<ul>
<li>  <code>da = -Math.PI / 4</code> when <code>n == 4</code> (i.e. rotate 90 degrees)</li>
<li>  <code>da = 0</code> when <code>n == 2</code> (i.e. keep at default 0 degrees)</li>
<li>  <code>da = -Math.PI / 2</code> otherwise (i.e. rotate 180 degrees)</li>
</ul>

<p>Applying the introduction of the <code>da</code> variable and including this as part of the construction of the angle <code>a</code> yields us our
finalized formulation of the function <code>generatePoints</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Generate and distribute points
 */</span>
<span class="kd">function</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">factors</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">parentPoints</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">da</span><span class="p">,</span> <span class="nx">point</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="nx">factors</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">d</span> <span class="o">*=</span> <span class="nx">n</span><span class="p">;</span> <span class="c1">// scale depth</span>
    <span class="nx">n</span> <span class="o">=</span> <span class="nx">factors</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="c1">// build points from outwards</span>
    <span class="nx">da</span> <span class="o">=</span> <span class="nx">n</span> <span class="o">===</span> <span class="mi">4</span> <span class="p">?</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">4</span> <span class="p">:</span> <span class="nx">n</span> <span class="o">===</span> <span class="mi">2</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="o">-</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// apply offset logic here</span>
    <span class="nx">r</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">100</span> <span class="p">?</span> <span class="nx">r</span> <span class="o">*=</span> <span class="mi">1</span> <span class="o">/</span> <span class="nx">n</span> <span class="p">:</span> <span class="nx">r</span> <span class="o">*=</span> <span class="mf">0.7</span><span class="p">;</span>  <span class="c1">// aesthetic scale factor to increase size at higher values of n</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// account for first set of points</span>
      <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">da</span><span class="p">;</span>  <span class="c1">// apply offset da to angle a</span>
        <span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
        <span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
        <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
      <span class="p">});</span>

    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// iteratively build points by keeping track of parentPoints</span>
      <span class="nx">parentPoints</span> <span class="o">=</span> <span class="nx">points</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span>
      <span class="nx">points</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">parentPoints</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">parentPoint</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">d3</span><span class="p">.</span><span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">n</span> <span class="o">+</span> <span class="nx">da</span><span class="p">;</span>  <span class="c1">// apply offset da to angle a</span>
          <span class="nx">x</span> <span class="o">=</span> <span class="nx">parentPoint</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span><span class="p">;</span>
          <span class="nx">y</span> <span class="o">=</span> <span class="nx">parentPoint</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">/</span> <span class="nx">d</span><span class="p">;</span>
          <span class="nx">point</span> <span class="o">=</span> <span class="nx">createPoint</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
          <span class="nx">points</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">point</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">points</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>And our visualization is now looking right and great.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-180.png" alt="image-180"></p>

<p>That was a heavy section, so let&#39;s wrap it up in a quick summary:</p>

<ul>
<li>  Find a way to generate variables <code>x</code>, <code>y</code>, <code>r</code> (minimal plotting requirements) from knowledge on the <code>factors</code></li>
<li>  array.</li>
<li>  The <code>factors</code> array encodes information on <code>n</code> vertices, which we found ways to express <code>x(n)</code>, <code>y(n)</code>, <code>r(n)</code>,</li>
<li>  <code>a(n)</code>, <code>d(n)</code>, <code>da(n)</code> as functions of <code>n</code>.</li>
<li>  We break the generation of points into an generating an initial set of outer points, followed by a recursive logic</li>
<li>  of generating nested inner points while applying the neccessary depth scaling factors.</li>
</ul>

<h3 id="visualization-components">Visualization components</h3>

<p>In the previous section, we made &quot;invisible&quot; mention and displayed images to the visualization without describing its
implementation.  The goal of the previous section was to focus only on the logic of generating the right <code>points</code> data that
D3 can use for plotting.</p>

<p>The goal of this section is to now build on how we inform D3 to take the <code>points</code> data and plot the results.</p>

<p>At the highest of level, our visualization application should run with three simple calls:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// initiate vis object</span>
<span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="p">{};</span>

<span class="c1">// call an initialization function to build vis</span>
<span class="nx">init</span><span class="p">();</span>  

<span class="c1">// setup an interval reference to update based on a set speed</span>
<span class="kd">var</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="nx">speed</span><span class="p">);</span>
</code></pre></div>
<p>You can see this simple call at the top of the <a href="https://gist.githubusercontent.com/chrisrzhou/3fec15b05684fa0cf42e/raw/c57df3d28276ae2affa786a408fd042ce51e14b3/draw.js">draw.js</a> file.  What remains now is to implement <code>init</code> and <code>update</code>.</p>

<p>There are a number of things we should initialize in the <code>vis</code> object:</p>

<ul>
<li>  <code>vis.size</code>: size of the SVG</li>
<li>  <code>vis.speed</code>: to determine how fast <code>setInterval</code> calls <code>update</code></li>
<li>  <code>vis.number</code>: the number to be factorized and visualized</li>
<li>  <code>vis.factors</code>: the factor array for <code>vis.number</code></li>
<li>  <code>vis.points</code>: the points generated when <code>vis.factors</code> is passed into the <code>generatePoints</code> i.e. the function we wrote
in the previous section</li>
<li>  <code>vis.scale</code>: the scale and domain range of the visualization</li>
<li>  <code>vis.svg</code>: the main SVG object that D3 will build upon</li>
<li>  <code>vis.trackerNumber</code>: the number that we will display in the visualization</li>
<li>  <code>vis.trackerFactors</code>: the string representation of the factorization of <code>vis.number</code></li>
</ul>

<p>Following the above requirements, here is our implementation for the <code>init</code> function:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// vis parameters</span>
  <span class="nx">vis</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">size</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
    <span class="na">number</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="na">speed</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="c1">// get prime factors</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">factors</span> <span class="o">=</span> <span class="nx">primeFactors</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="p">);</span>

  <span class="c1">// build data points</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">points</span> <span class="o">=</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="p">);</span>

  <span class="c1">// build scale</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">scale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">size</span><span class="p">])</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>

  <span class="c1">// build vis svg</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#vis"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"svg"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"width"</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"g"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"transform"</span><span class="p">,</span> <span class="s2">"translate("</span> <span class="o">+</span> <span class="p">[</span><span class="nx">vis</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">);</span>

  <span class="c1">// build vis tracker number</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">trackerNumber</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">svg</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"svg:text"</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s2">"trackerNumber"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="o">-</span><span class="nx">vis</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="o">-</span><span class="nx">vis</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span> <span class="s2">"30px"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="s2">"gray"</span><span class="p">);</span>

  <span class="c1">// build vis tracker factors</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">trackerFactors</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">svg</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"svg:text"</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s2">"trackerFactors"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span> <span class="o">-</span><span class="nx">vis</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"y"</span><span class="p">,</span> <span class="o">-</span><span class="nx">vis</span><span class="p">.</span><span class="nx">size</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">25</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"font-size"</span><span class="p">,</span> <span class="s2">"14px"</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="s2">"gray"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>The next section is to help build the logic of our <code>update</code> function, which will be repeatedly called by <code>setInterval</code> to
update numbers and the visualization.</p>

<p><code>update</code> should handle:</p>

<ul>
<li>  updating <code>vis.number</code> and <code>vis.factors</code>.</li>
<li>  regenerate <code>vis.points</code> when <code>vis.factors</code> is updated.</li>
<li>  update <code>vis.colorScale</code> since we have to update our color domain range due to changing array size.</li>
<li>  apply transition effects for new data, old data, shifting data</li>
</ul>

<p>We will first handle updates to <code>vis.number</code>, <code>vis.factors</code>, <code>vis.points</code>, and <code>vis.colorScale</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Update function for setInterval
 */</span>
<span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// extend functino with the option to pass a direction</span>
  <span class="c1">// to either increment or decrement vis.number</span>
  <span class="c1">// i.e. if true, increase vis.number, if false, decrease vis.number</span>
  <span class="nx">pos</span> <span class="p">?</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">number</span> <span class="o">++</span> <span class="p">:</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">number</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">?</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="o">--</span> <span class="p">:</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="p">;</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">factors</span> <span class="o">=</span> <span class="nx">primeFactors</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="p">);</span>  <span class="c1">// update factors</span>

  <span class="c1">// update tracker</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">trackerNumber</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">text</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">number</span><span class="p">);</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">trackerFactors</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">text</span><span class="p">(</span><span class="nx">printFactors</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">factors</span><span class="p">));</span>

  <span class="c1">// update points</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">points</span> <span class="o">=</span> <span class="nx">generatePoints</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">factors</span><span class="p">);</span> <span class="c1">// create new points</span>

  <span class="c1">// make a reference to each point object</span>
  <span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">".point"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">points</span><span class="p">);</span>

  <span class="c1">// update colorscale</span>
  <span class="nx">vis</span><span class="p">.</span><span class="nx">colorScale</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">scale</span><span class="p">.</span><span class="nx">linear</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">domain</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">points</span><span class="p">.</span><span class="nx">length</span><span class="p">])</span>  <span class="c1">// rescale since vis.points.length has changed</span>
    <span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="s2">"#1f77b4"</span><span class="p">,</span> <span class="s2">"#d62728"</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="updates-and-transitions">Updates and transitions</h3>

<p>In the earlier section, we made a D3 selection reference to <code>point</code> in the <code>update</code> function i.e.</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">".point"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">points</span><span class="p">);</span>
</code></pre></div>
<p>We can now build on this selection and construct <code>enter</code>, <code>exit</code>, <code>transition</code> animations:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Update function for setInterval
 */</span>
<span class="kd">function</span> <span class="nx">update</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">...</span>

  <span class="kd">var</span> <span class="nx">point</span> <span class="o">=</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">svg</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">".point"</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">points</span><span class="p">);</span>

  <span class="c1">// enter</span>
  <span class="nx">point</span><span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"svg:circle"</span><span class="p">).</span><span class="nx">classed</span><span class="p">(</span><span class="s2">"point"</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">speed</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span> <span class="p">})</span>  <span class="c1">// scale radius of data point with size of vis</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="p">})</span>  <span class="c1">// apply vis.scales to x and y</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">colorScale</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="p">});</span>  <span class="c1">// apply vis.colorScale to index of data points</span>

  <span class="c1">// update</span>
  <span class="nx">point</span><span class="p">.</span><span class="nx">transition</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">duration</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">speed</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">r</span> <span class="o">*</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cx"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">x</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"cy"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"fill"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">colorScale</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span> <span class="p">});</span>

  <span class="c1">//exit</span>
  <span class="nx">point</span><span class="p">.</span><span class="nx">exit</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="nx">vis</span><span class="p">.</span><span class="nx">speed</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">"r"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>We are now done with our implementation of <code>init</code> and <code>update</code> and we can initialize our D3 visualization with three simple
calls!</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">vis</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">init</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">speed</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre></div>
<p><sub>(<a href="#contents">back to contents</a>)</sub></p>

<hr>

<h2 id="adding-user-interactions">Adding User Interactions</h2>

<p>We can provide a few interactive options for the users without overcomplicating our D3 code by initiating these interactions
in the <code>init</code> function, and pausing and resetting <code>intervals</code> with the use of <code>setInterval</code> and <code>clearInterval</code>.</p>

<p>Let&#39;s build out the set of HTML widget controls and tag them with unique <code>ids</code> so D3 can select and reference them:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- controls --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"btn-group controls"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"number"</span> <span class="na">class=</span><span class="s">"btn btn-default btn-sm"</span> <span class="na">title=</span><span class="s">"Input a number"</span> <span class="na">id=</span><span class="s">"inputNumber"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-default btn-sm"</span> <span class="na">title=</span><span class="s">"Search"</span> <span class="na">id=</span><span class="s">"search"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-search"</span><span class="nt">&gt;&lt;/i&gt;&lt;/a&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-default btn-sm"</span> <span class="na">title=</span><span class="s">"Backward"</span> <span class="na">id=</span><span class="s">"backward"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-chevron-left"</span><span class="nt">&gt;&lt;/i&gt;&lt;/a&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-default btn-sm"</span> <span class="na">title=</span><span class="s">"Stop"</span> <span class="na">id=</span><span class="s">"stop"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-stop"</span><span class="nt">&gt;&lt;/i&gt;&lt;/a&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"btn btn-default btn-sm"</span> <span class="na">title=</span><span class="s">"Forward"</span> <span class="na">id=</span><span class="s">"forward"</span><span class="nt">&gt;&lt;i</span> <span class="na">class=</span><span class="s">"fa fa-chevron-right"</span><span class="nt">&gt;&lt;/i&gt;&lt;/a&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>Note that we are using an icon set <code>&lt;i&gt;&lt;/i&gt;</code> from <a href="http://fortawesome.github.io/Font-Awesome/">Font Awesome</a> to help add some visuals to our widget :)</p>

<p>Let&#39;s now move from the HTML workstation to JavaScript.</p>

<h3 id="stop">Stop</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#stop"</span><span class="p">)</span>  <span class="c1">// select by id</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>  <span class="c1">// clear interval</span>
  <span class="p">});</span>
</code></pre></div>
<h3 id="forward">Forward</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#forward"</span><span class="p">)</span>  <span class="c1">// select by id</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>  <span class="c1">// clear interval</span>
    <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">speed</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>  <span class="c1">// reinitialize interval</span>
  <span class="p">});</span>
</code></pre></div>
<p>Note that we are passing the parameter <code>true</code> to <code>update</code>, which sets <code>vis.number</code> to increment each time <code>update</code> is
called.</p>

<h3 id="backward">Backward</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#backward"</span><span class="p">)</span>  <span class="c1">// select by id</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>  <span class="c1">// clear interval</span>
    <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="nx">vis</span><span class="p">.</span><span class="nx">speed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>  <span class="c1">// reinitialize interval</span>
  <span class="p">});</span>
</code></pre></div>
<p>Note that we are passing the parameter <code>false</code> to <code>update</code>, which sets <code>vis.number</code> to decrement each time <code>update</code> is
called.</p>

<h3 id="search">Search</h3>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">"#search"</span><span class="p">)</span>  <span class="c1">// select by id</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">vis</span><span class="p">.</span><span class="nx">number</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"inputNumber"</span><span class="p">).</span><span class="nx">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// update vis.number</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>  <span class="c1">// clear interval</span>
    <span class="nx">update</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  <span class="c1">// call update once</span>
  <span class="p">});</span>
</code></pre></div>
<p>For the <code>search</code> implementation, we assume that the user is prompted to pause and reflect on their searched result.  We
achieve this by stopping the <code>interval</code> using <code>clearInterval</code>, and making one manual call to <code>update</code> to visualize the
desired result.</p>

<p>One small thing to pay attention is that <code>update</code> alters <code>vis.number</code>, so we have to pass it <code>n - 1</code> if we wish to visualize
<code>n</code>:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">vis</span><span class="p">.</span><span class="nx">number</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"inputNumber"</span><span class="p">).</span><span class="nx">value</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</code></pre></div>
<p>where we have used generic JavaScript to obtain the <code>value</code> of the HTML <code>&lt;input/ &gt;</code> tag.</p>

<p>And there you have it: user interactivity to <code>stop</code>, <code>forward</code>, <code>backward</code>, and <code>search</code> visualizations of various numbers.</p>

<p>Go ahead and test it out!</p>

<p><sub>(<a href="#contents">back to contents</a>)</sub></p>

<hr>

<h2 id="samples">Samples</h2>

<p>Here&#39;s a collection of interesting and beautiful samples.  Feel free to explore and share any insightful ones you find in
the comments below.</p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-243.png" alt="image-243"></p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-625.png" alt="image-625"></p>

<p><img src="https://s3-us-west-1.amazonaws.com/chrisrzhou/datanaut/projects/d3-dances-with-factors/image-1024.png" alt="image-1024"></p>

<p><sub>(<a href="#samples">back to contents</a>)</sub></p>

<hr>

<h2 id="resources">Resources</h2>

<p>This work would not be possible without the original creative ideas and implementations made by others.  I hope that my
tutorial and implementation will spark interest in many others to share and expand on the foundations built for us.</p>

<ul>
<li>  <a href="https://gist.github.com/chrisrzhou/3fec15b05684fa0cf42e">Github source code</a></li>
<li>  <a href="http://mathlesstraveled.com/2012/10/05/factorization-diagrams/">Brent Yorgey&#39;s original idea</a></li>
<li>  <a href="http://www.datapointed.net/visualizations/math/factorization/animated-diagrams/">Stephen Von Worley&#39;s interactive version</a></li>
<li>  <a href="http://www.jasondavies.com/factorisation-diagrams/">Jason Davies&#39; recursive D3 implementation</a></li>
<li>  <a href="http://en.wikipedia.org/wiki/Sierpinski_triangle">Sierpinski Triangle</a></li>
<li>  <a href="http://bl.ocks.org/mbostock/3808234">Mike Bostock&#39;s General Update Pattern</a></li>
</ul>

<p>Thanks for viewing!</p>

<p><sub>(<a href="#contents">back to contents</a>)</sub></p>

<hr>

<!-- external links -->

<!-- image links -->

</article>

<!-- disqus comments -->
<div id="disqus_thread"></div>
<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'datanaut'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'datanaut'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>


</div>

<!-- footer section -->
<footer>
  <div class="container">
    <p>
      <!--<a href="https://github.com/ahmedtadde/ahmedtadde.io" target="_blank">-->
        <i class="fa fa-rocket"></i> Datanaut
      </a> by Ahmed Tadde <br/>
      launched with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> fuel.
    </p>

    <ul class="list-inline social">
      <li><a href="https://github.com/ahmedtadde" target="_blank"><i class="fa fa-github"></i></a></li>
      <!--<li><a href="https://twitter.com/ahmedtadde" target="_blank"><i class="fa fa-twitter"></i></a></li>-->
      <!--<li><a href="https://linkedin.com/in/ahmedtadde" target="_blank"><i class="fa fa-linkedin"></i></a></li>-->
    </ul>
  </div>
</footer>

<!DOCTYPE html>
<html>
<head lang="en">
        <meta charset="UTF-8">
        <title></title>
</head>
<body>

</body>
</html>

<!-- scripts section -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

</body>

</html>
